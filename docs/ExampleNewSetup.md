# New project setup

Example steps for setting up a new project using MikeyT.DbMigrations NuGet package and the suggested package.json/gulpfile commands/tasks:

- Create solution with `dotnet new sln -o example-solution`
- `cd example-solution`
- `mkdir src`
- `cd src`
- `dotnet new webapi -o ExampleApi`
- `dotnet new console -o DbMigrator`
- `cd ..`
- `dotnet sln add src/ExampleApi/ExampleApi.csproj`
- `dotnet sln add src/DbMigrator/DbMigrator.csproj`
- Add NuGet dependencies to ExampleApi
    - Dapper
    - Npgsql
    - MikeyT.EnvironmentSettings
- Add NuGet dependencies to DbMigrator
    - Microsoft.EntityFrameworkCore.Design
    - Npgsql
    - MikeyT.DbMigrations
    - MikeyT.EnvironmentSettings
- In DbMigrator, add MainDbContext class (see example project)
- In DbMigrator `Program.cs`, add one-liner (see example project)
- Create or copy over `package.json`/`gulpfile.js` commands/tasks (see example project)
- Create or copy over `.env.template`
- Copy `.env.template` to `.env` and modify values to whatever is appropriate
- Run `npm run dockerUp`
- Run `npm run dbInitialCreate`
- Create initial DB migration with `npm run dbAddMigration -- --name=Initial`
- Run `npm run dbMigrate`
- Create new migration for test model with `npm run dbAddMigration -- --name=AddPerson`
- Create `Scripts` directory in root of console DbMigrator app and populate with blank `AddPerson.sql` and `AddPerson_Down.sql` files
    - Set scripts directory as content to be copied to bin using entry in DbMigrator.csproj (see example project .csproj)
- Fill in add table statement in `AddPerson.sql` and drop in `AddPerson_Down.sql` (see example project)
- In auto-generated `[date]_AddPerson.cs` methods, add call to extension method:
    - In `Up()` use the example line `MigrationScriptRunner.RunScript(migrationBuilder, "AddPerson.sql");`
    - In `Down()` use the example line `MigrationScriptRunner.RunScript(migrationBuilder, "AddPerson_Down.sql");`
- Run `npm run dbMigrate`
- Add data access and controller code (see example project)
- Add environment settings and dependency injection setup to ExampleApi project `Program.cs` (see example project)
- Run `npm run api` (alias for `dotnet watch` pointing to the api project)